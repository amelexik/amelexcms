<?if (!empty($pAction)){	if ($pAction == "add_admin" or $pAction == "update_admin"){		$back_url = "?section=".$admin->section;		$admin_id = (int)clearvar(@$_POST["admin_id"]);				//echo $pAction; exit;				$name = clearvar($_POST["name"]);		$login = clearvar($_POST["login"]);		$password = clearvar($_POST["password"]);		if ($pAction == "add_admin"){			$errors = array();			if (empty($name)){				$errors["name"] = "Вы не ввели имя администратора";			}			if (empty($login)){				$errors["login"] = "Не указали логин";			}			if (empty($password)){				$errors["password"] = "Пароль слишком короткый";			}						if (empty($errors)){				if (checkLogin($login,$table="admins") == false){					$errors["login"] = "Логин <b>{$login}</b> уже используется, попробуйте другой";				}			}						if (empty($errors)){				$sql = "INSERT INTO admins (name,login,password)VALUES('{$name}','{$login}','".md5($password)."')";			}		}		if ($pAction == "update_admin"){			if ($admin_id > 0){							$errors = array();				if (empty($name)){					$errors["name"] = "Вы не ввели имя администратора";				}							if ($password == ""){					$sql = "UPDATE admins SET name='{$name}' WHERE id={$admin_id}";				}				else{					$sql = "UPDATE admins SET name='{$name}',password='".md5($password)."' WHERE id={$admin_id}";				}			}		}					if (empty($errors)){			if ($sql != ''){				//echo $sql;				$admin->db->query($sql);				header("location:$back_url");				exit;			}		}		else{			$smarty->assign("errors",$errors);			//print_r($errors);		}	}}if (!$admin->mode){	$tmp1 = array();	$tmp2 = array();	if ($_SESSION["admin"]["root"] == "y"){		$sql1 = "SELECT * FROM admins WHERE root='n'";		$sql2 = "SELECT * FROM admins WHERE root='y' AND id={$_SESSION["admin"]["id"]}";	}	else{		$sql1 = "SELECT * FROM admins WHERE id={$_SESSION["admin"]["id"]}";	}	$tmp1 = $admin->db->select($sql1);		if(!empty($sql2)){		$tmp2 = $admin->db->select($sql2);	}	$admins = array_merge($tmp2,$tmp1);		foreach($admins as $key => $value){		if($_SESSION["admin"]["root"] == "y"){			if($_SESSION["admin"]["id"] > 0){				if ($value["id"] == $_SESSION["admin"]["id"]){					$admins["{$key}"]["name"] = "<b>".$value["name"]." (это вы)</b>";				}			}		}		$admins["{$key}"]["edit_url"] = "?section=".$admin->section."&mode=add_edit_admin&admin_id=".$value["id"];	}		$smarty->assign("admins",$admins);}else{	if ($admin->mode == "add_edit_admin"){		if($admin_id>0){					$is_root = $admin->db->selectCell("SELECT root FROM admins WHERE id={$admin_id}");						if ($_SESSION["admin"]["root"] != "y"){				if ($is_root == 'y'){					echo "access denied for user!";					exit;				}			}			if ($_SESSION["admin"]["root"] == "y"){				if ($is_root == 'y'){					if ($admin_id != $_SESSION["admin"]["id"]){						echo "access denied for user";						exit;					}				}			}					$item = $admin->db->selectRow("SELECT * FROM admins WHERE id={$admin_id}");			//print_r($item);			$smarty->assign("item",$item);		}	}}?>