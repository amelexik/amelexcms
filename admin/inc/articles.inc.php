<?if (!empty($gAction)){	if ($gAction == "dropArticleItem"){		$back_url = "?section=".$admin->section."&structure_master_id=".$structure_master_id;		if ($article_master_id>0){			$mainSQL = "DELETE FROM articles WHERE id={$article_master_id}";			$admin->db->query($mainSQL);			foreach ($admin->languages2 as $lang_id => $lang_prefix){				$sql = "DELETE FROM articles_ext WHERE master_id={$article_master_id} AND lang={$lang_id}";				$admin->db->query($sql);			}			header("location:$back_url");			exit;		}		else{			echo "article_master_id NULL!";			exit();		}	}}if (!empty($pAction)){	if ($pAction == "add_article_item" or $pAction == "update_article_item"){		$back_url = "?section=".$admin->section."&structure_master_id=".$structure_master_id;		if ($pAction == "add_article_item"){			$mainSQL = "INSERT INTO articles(structure_master_id)VALUES({$structure_master_id})";			$admin->db->query($mainSQL);			$insert_id = (int) mysql_insert_id();		}		foreach ($admin->languages2 as $lang_id => $lang_prefix){			$name = clearvar($_POST["item"][$lang_id]["name"]);			$translit = translit(clearvar($_POST["item"][$lang_id]["translit"]));			if ($translit == ''){$translit = translit(_strtolower($name));}			$display = clearvar($_POST["item"][$lang_id]["display"]);			$preview = addslashes(clearvar($_POST["item"][$lang_id]["preview"]));			$content = addslashes(clearvar($_POST["item"][$lang_id]["content"]));						if ($pAction == "add_article_item"){				$sql = "INSERT INTO articles_ext(master_id,lang,name,translit,preview,content,display)VALUES({$insert_id},{$lang_id},'{$name}','{$translit}','{$preview}','{$content}','{$display}')";			}			if ($pAction == "update_article_item"){				$sql = "UPDATE articles_ext SET name='{$name}',translit='{$translit}',preview='{$preview}',content='{$content}',display='{$display}' WHERE lang={$lang_id} AND master_id={$article_master_id}";			}			$admin->db->query($sql);		}		header("location:$back_url");		exit;	}}if (!$admin->mode){		$articles = array();	$tmp = $admin->db->select("SELECT * FROM articles WHERE structure_master_id={$structure_master_id} ORDER by add_date DESC");	if (!empty($tmp)){		foreach($tmp as $key => $item){			$articles["{$item["id"]}"]["id"] = $item["id"];			$articles["{$item["id"]}"]["structure_master_id"] = $item["structure_master_id"];			$articles["{$item["id"]}"]["add_date"] = $item["add_date"];						foreach($admin->languages2 as $lang_id => $lang_prefix){				$articles_ext_data = $admin->db->selectRow("SELECT articles_ext.name, articles_ext.translit, articles_ext.display FROM articles_ext WHERE articles_ext.master_id={$item["id"]} AND articles_ext.lang={$lang_id}");								$articles["{$item["id"]}"]["ext"]["{$lang_id}"]["name"] = stripslashes($articles_ext_data["name"]);				$articles["{$item["id"]}"]["ext"]["{$lang_id}"]["translit"] = $articles_ext_data["translit"];				$articles["{$item["id"]}"]["ext"]["{$lang_id}"]["display"] = $articles_ext_data["display"];			}				}	}}else{	if ($admin->mode == "add_edit_article"){		if($article_master_id > 0){			$item = array();			$mainData = $admin->db->selectRow("SELECT * FROM articles WHERE id={$article_master_id}");			$item["id"] = $mainData["id"];			$item["structure_master_id"] = $mainData["structure_master_id"];			$item["add_date"] = $mainData["add_date"];			foreach($admin->languages2 as $lang_id => $lang_prefix){				$item_ext_data_tmp = $admin->db->selectRow("SELECT articles_ext.* FROM articles_ext WHERE articles_ext.master_id={$mainData["id"]} AND articles_ext.lang={$lang_id}");								//$item_ext_data["master_id"] = stripslashes($item_ext_data_tmp["name"]);				//$item_ext_data["lang"] = stripslashes($item_ext_data_tmp["name"]);								$item_ext_data["name"] = stripslashes($item_ext_data_tmp["name"]);				$item_ext_data["translit"] = ($item_ext_data_tmp["translit"]);								$item_ext_data["preview"] = stripslashes($item_ext_data_tmp["preview"]);				$item_ext_data["content"] = stripslashes($item_ext_data_tmp["content"]);								$item_ext_data["display"] = ($item_ext_data_tmp["display"]);								$item["ext"]["{$lang_id}"] = $item_ext_data;			}			//print_r($item);			$smarty->assign("item",$item);		}		else{		}	}}//print_r($articles);$smarty->assign("articles",$articles);?>