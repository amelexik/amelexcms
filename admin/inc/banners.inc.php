<?if (!empty($gAction)){	if ($gAction == "dropBanner"){		$back_url = "?section=".$admin->section;		if ($banner_id > 0){			$mainSQL = "DELETE FROM banners WHERE banners.id={$banner_id}";			$admin->db->query($mainSQL);			foreach($admin->languages2 as $lang_id => $lang_prefix){				$sql = "DELETE FROM banners_ext WHERE banners_ext.master_id={$banner_id} AND banners_ext.lang={$lang_id}";				$admin->db->query($sql);			}		}		header("location:$back_url");		exit;	}}if (!empty($pAction)){	if ($pAction == "add_banner" or $pAction == "update_banner"){				$banner_master_id = (int)$_POST["banner_master_id"];				$back_url = "?section=".$admin->section;		if ($submit_mode == "set"){$back_url.="&mode=add_edit_banner&banner_id={$banner_master_id}";}				$mainSQL = "";				if ($pAction == "add_banner"){			$banners_count = count($admin->db->selectCell("SELECT id FROM banners"));			$sorting = $banners_count + 1;			$mainSQL = "INSERT INTO banners(sorting)VALUES('{$sorting}')";		}				if ($mainSQL != ""){			$admin->db->query($mainSQL);		}				$insert_id = mysql_insert_id();		//$insert_id = 777;				foreach($admin->languages2 as $lang_id => $lang_prefix){						$title = clearvar($_POST["item"][$lang_id]["title"]);			$display = clearvar($_POST["item"][$lang_id]["display"]);			//$display_everywhere = clearvar($_POST["item"][$lang_id]["display_everywhere"]);			$content = addslashes(clearvar($_POST["item"][$lang_id]["content"]));									if ($pAction == "update_banner"){				$sql = "					UPDATE banners_ext 					SET 					banners_ext.title='{$title}',					banners_ext.display='{$display}',					banners_ext.content='{$content}' 					WHERE 					banners_ext.master_id={$banner_master_id}					AND banners_ext.lang={$lang_id}										";			}			if ($pAction == "add_banner"){				$sql = "					INSERT INTO banners_ext 					(master_id,lang,title,display,content)					VALUES					({$insert_id},{$lang_id},'{$title}','{$display}','{$content}')				";						}						//echo $sql;			$admin->db->query($sql);		}		header("location:$back_url");		exit;	}}if (!$admin->mode){	$banners = array();	$tmp = $admin->db->select("SELECT banners.* FROM banners ORDER by banners.sorting ASC");	foreach($tmp as $key => $value){		$banners["{$value["id"]}"]["id"] = $value["id"];		$banners["{$value["id"]}"]["edit_url"] = "?section=".$admin->section."&mode=add_edit_banner&banner_id=".$value["id"];		$banners["{$value["id"]}"]["drop_url"] = "?section=".$admin->section."&gAction=dropBanner&banner_id=".$value["id"];		$banners["{$value["id"]}"]["ext"] = array();		foreach($admin->languages2 as $lang_id => $lang_prefix){			$tmp_ext = $admin->db->selectRow("SELECT banners_ext.* FROM banners_ext WHERE banners_ext.master_id={$value["id"]} AND banners_ext.lang={$lang_id}");			$ext["{$lang_id}"]["title"] = $tmp_ext["title"];			$ext["{$lang_id}"]["display"] = $tmp_ext["display"];			$banners["{$value["id"]}"]["ext"] = $ext;		}	}	//print_r($banners);	$smarty->assign("banners",$banners);}else{	if ($admin->mode == "add_edit_banner"){		if ($banner_id > 0){			$item = $admin->db->selectRow("SELECT banners.id FROM banners WHERE banners.id={$banner_id}");			//SELECT `id`, `master_id`, `lang`, `title`, `link_url`, LEFT(`content`, 256), `display`, `display_everywhere` FROM `pmatools`.`banners_ext` LIMIT 0, 1000;			foreach($admin->languages2 as $lang_id => $lang_prefix){				$tmp_ext = $admin->db->selectRow("SELECT banners_ext.title,banners_ext.content,banners_ext.display FROM banners_ext WHERE banners_ext.master_id={$banner_id}");				$tmp_ext["title"] = stripslashes($tmp_ext["title"]);				$tmp_ext["content"] = stripslashes($tmp_ext["content"]);				$item["ext"]["{$lang_id}"] = $tmp_ext;			}			//print_r($item);			$smarty->assign("item",$item);		}	}}?>