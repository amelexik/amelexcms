<?if (!empty($gAction)){	if ($gAction == "dropUser"){		$back_url = "?section={$admin->section}";		if ($user_id > 0){			$sql = "DELETE FROM users WHERE users.id={$user_id}";			$admin->db->query($sql);		}		header("location:$back_url");		exit;	}}/*Array(    [name] => Дональд Трамп    [login] => donald_trump    [city] => New York City    [phone_num] => +12354565854    [costumer_type] => legal_entity    [company] => Trump Tower    [password] =>     [email] => donald_trump@gmail.com    [active] => y    [pAction] => update_user)*/if (!empty($pAction)){	if ($pAction == "update_user" or $pAction == "add_user"){				$back_url = "?section=".$admin->section;				$name = clearvar($_POST["name"]);		$login = clearvar($_POST["login"]);		$city = clearvar($_POST["city"]);		$phone_num = clearvar($_POST["phone_num"]);		$costumer_type = clearvar($_POST["costumer_type"]);		$company = clearvar($_POST["company"]);		$password = clearvar($_POST["password"]);		$email = clearvar($_POST["email"]);		$active = clearvar($_POST["active"]);		$discount = (int) clearvar($_POST["discount"]);		$user_price = clearvar($_POST["user_price"]);				$user_id = (int)$_POST["user_id"];				if ($pAction == "update_user"){			if ($user_id > 0){				$sql = "UPDATE users SET name='{$name}',login='{$login}',city='{$city}',phone_num='{$phone_num}',costumer_type='{$costumer_type}',email='{$email}',active='{$active}',discount='{$discount}',user_price='{$user_price}' WHERE id={$user_id}";				$admin->db->query($sql);				if (!empty($password)){					$sql2 = "UPDATE users SET password='".md5($password)."' WHERE id={$user_id}";					$admin->db->query($sql2);				}				if (!empty($company) && $costumer_type == "legal_entity"){					$sql3 = "UPDATE users SET company='{$company}' WHERE id={$user_id}";					$admin->db->query($sql3);				}			}		}				if ($pAction == "add_user"){			$sql = "				INSERT INTO users 				(name,login,city,phone_num,costumer_type,company,password,email,active,discount)				VALUES				('{$name}','{$login}','{$city}','{$phone_num}','{$costumer_type}','{$company}','".md5($password)."','{$email}','{$active}','{$discount}');			";			$admin->db->query($sql);		}				header("location:$back_url");		exit;		}}if (!$admin->mode){	$usersCount = count($admin->db->select("SELECT id FROM users"));	$smarty->assign('usersCount',$usersCount);		$from_list = $admin->db->select("SELECT id,title FROM users_from_list");	$stats = array();	foreach($from_list as $key => $value){		$listId = $value["id"];			$count_variant = count($admin->db->select("SELECT id FROM users WHERE from_user='{$listId}'"));		$stats["{$listId}"]["title"] = $value["title"];		$stats["{$listId}"]["count"] = $count_variant;	}		$smarty->assign('stats',$stats);			$tmp = $admin->db->select("SELECT * FROM users ORDER by id DESC");		/*            [id] => 5            [name] => Дональд Трамп            [login] => donald_trump            [city] => New York City            [phone_num] => +12354565854            [costumer_type] => legal_entity            [company] => Trump Tower            [password] => ad38b991e3f82cc6099c54ef69d44d47            [email] => donald_trump@gmail.com            [activate_code] => 6d7bc9c28965d964a5f71d74e15d5ec2            [active] => y	*/		$users = array();	if (!empty($tmp)){		foreach($tmp as $key => $user){			$users["{$user["id"]}"]["id"] = $user["id"];			$users["{$user["id"]}"]["name"] = $user["name"];			$users["{$user["id"]}"]["login"] = $user["login"];			$users["{$user["id"]}"]["active"] = $user["active"];		}	}		$smarty->assign('users',$users);}else{	if ($admin->mode == "add_edit_user"){		if ($user_id>0){			$userData = $admin->db->selectRow("SELECT * FROM users WHERE id={$user_id}");			$smarty->assign("userData",$userData);			//print_r($userData);		}	}}?>